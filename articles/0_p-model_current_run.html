<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>P-model current run • sofunCalVal</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="P-model current run">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sofunCalVal</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/0_p-model_current_run.html">P-model current run</a></li>
    <li><a class="dropdown-item" href="../articles/1_p-model_reference_run.html">P-model reference run</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/geco-bern/sofunCalVal/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>P-model current run</h1>
                        <h4 data-toc-skip class="author">Koen Hufkens
and Beni Stocker</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/geco-bern/sofunCalVal/blob/main/vignettes/0_p-model_current_run.Rmd" class="external-link"><code>vignettes/0_p-model_current_run.Rmd</code></a></small>
      <div class="d-none name"><code>0_p-model_current_run.Rmd</code></div>
    </div>

    
    
<p>This workflow runs the P-model with {rsofun} with the latest version
and forcing as used in Stocker et al. (2020). Calibration and evaluation
data is also as in Stocker et al. (2020). All data is from files created
for Stocker et al. (2020).</p>
<div class="section level2">
<h2 id="model-parameters">Model parameters<a class="anchor" aria-label="anchor" href="#model-parameters"></a>
</h2>
<p>Model parameters are determined for this version from calibration.
The code for model calibration is not shown. See
<code>vignettes/0_p-model_current_run.Rmd</code> for the code.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params_modl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  kphio              <span class="op">=</span> <span class="fl">0.04090209</span>, <span class="co"># 0.09423773,  # par_calib$par["kphio"],</span></span>
<span>  kphio_par_a        <span class="op">=</span> <span class="op">-</span><span class="fl">0.001366283</span>, <span class="co"># par_calib$par["kphio_par_a"],</span></span>
<span>  kphio_par_b        <span class="op">=</span> <span class="va">par_fixed</span><span class="op">[</span><span class="st">"kphio_par_b"</span><span class="op">]</span>,</span>
<span>  soilm_thetastar    <span class="op">=</span> <span class="va">par_fixed</span><span class="op">[</span><span class="st">"soilm_thetastar"</span><span class="op">]</span>,</span>
<span>  soilm_betao        <span class="op">=</span> <span class="fl">0.683499654</span>, <span class="co"># par_calib$par["soilm_betao"], # 0,  # </span></span>
<span>  beta_unitcostratio <span class="op">=</span> <span class="va">par_fixed</span><span class="op">[</span><span class="st">"beta_unitcostratio"</span><span class="op">]</span>,</span>
<span>  rd_to_vcmax        <span class="op">=</span> <span class="va">par_fixed</span><span class="op">[</span><span class="st">"rd_to_vcmax"</span><span class="op">]</span>,</span>
<span>  tau_acclim         <span class="op">=</span> <span class="va">par_fixed</span><span class="op">[</span><span class="st">"tau_acclim"</span><span class="op">]</span>,</span>
<span>  kc_jmax            <span class="op">=</span> <span class="fl">0.200000000</span> <span class="co"># par_calib$par["kc_jmax"] # 0.41  # </span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-run">Model run<a class="anchor" aria-label="anchor" href="#model-run"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">rsofun</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rsofun/man/runread_pmodel_f.html" class="external-link">runread_pmodel_f</a></span><span class="op">(</span></span>
<span>  <span class="va">df_drivers_fluxnet2015</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      forcing <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>        <span class="va">forcing</span>,</span>
<span>        <span class="op">~</span><span class="fu">rename</span><span class="op">(</span><span class="va">.</span>, rain <span class="op">=</span> <span class="va">rainf</span>, snow <span class="op">=</span> <span class="va">snowf</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      forcing <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>        <span class="va">forcing</span>,</span>
<span>        <span class="op">~</span><span class="fu">mutate</span><span class="op">(</span><span class="va">.</span>, netrad <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>  par <span class="op">=</span> <span class="va">params_modl</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run-evaluation">Run evaluation<a class="anchor" aria-label="anchor" href="#run-evaluation"></a>
</h2>
<p>This runs the <code><a href="../reference/eval_sofun.html">eval_sofun()</a></code> routine included in the
sofunCalVal package, and outputs daily, monthly and annual summary
statistics comparing observed with simulated values. We’ll retake this
same routine when running on the latest release (i.e. the workflow is
equivalent but for the release of the <code>rsofun</code> package)</p>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<table style="width:100%;" class="table">
<colgroup>
<col width="25%">
<col width="14%">
<col width="16%">
<col width="14%">
<col width="17%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">Level</th>
<th align="right">rsq</th>
<th align="right">rmse</th>
<th align="right">slope</th>
<th align="right">bias</th>
<th align="right">nvals</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">daily_pooled</td>
<td align="right">0.6711118</td>
<td align="right">2.274700</td>
<td align="right">0.9594255</td>
<td align="right">-0.1227976</td>
<td align="right">237777</td>
</tr>
<tr class="even">
<td align="left">xdaily_pooled</td>
<td align="right">0.7309871</td>
<td align="right">2.011392</td>
<td align="right">1.0525394</td>
<td align="right">-0.1201709</td>
<td align="right">33152</td>
</tr>
<tr class="odd">
<td align="left">annual_pooled</td>
<td align="right">0.6552680</td>
<td align="right">425.480412</td>
<td align="right">1.1957465</td>
<td align="right">-69.8919884</td>
<td align="right">598</td>
</tr>
<tr class="even">
<td align="left">monthly_pooled</td>
<td align="right">0.7575989</td>
<td align="right">1.844084</td>
<td align="right">1.0855110</td>
<td align="right">-0.2585732</td>
<td align="right">7428</td>
</tr>
<tr class="odd">
<td align="left">spatial</td>
<td align="right">0.6742977</td>
<td align="right">442.951690</td>
<td align="right">1.1592433</td>
<td align="right">-72.5740133</td>
<td align="right">109</td>
</tr>
<tr class="even">
<td align="left">anomalies_annual</td>
<td align="right">0.0819797</td>
<td align="right">167.420654</td>
<td align="right">0.5862724</td>
<td align="right">-2.7028986</td>
<td align="right">598</td>
</tr>
<tr class="odd">
<td align="left">meandoy</td>
<td align="right">0.7202762</td>
<td align="right">1.866047</td>
<td align="right">1.0356033</td>
<td align="right">0.0037699</td>
<td align="right">42844</td>
</tr>
<tr class="even">
<td align="left">anomalies_daily</td>
<td align="right">0.2685024</td>
<td align="right">1.531785</td>
<td align="right">0.4614379</td>
<td align="right">-0.0296151</td>
<td align="right">237603</td>
</tr>
<tr class="odd">
<td align="left">meanxoy</td>
<td align="right">0.7451584</td>
<td align="right">1.757658</td>
<td align="right">1.0598742</td>
<td align="right">-0.0092887</td>
<td align="right">5528</td>
</tr>
<tr class="even">
<td align="left">anomalies_xdaily</td>
<td align="right">0.1496114</td>
<td align="right">1.165698</td>
<td align="right">0.4538087</td>
<td align="right">-0.0025707</td>
<td align="right">33152</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="daily-spatial-and-annual">8-daily, spatial and annual<a class="anchor" aria-label="anchor" href="#daily-spatial-and-annual"></a>
</h3>
<p><img src="0_p-model_current_run_files/figure-html/unnamed-chunk-5-1.png" width="700"><img src="0_p-model_current_run_files/figure-html/unnamed-chunk-5-2.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="mean-seasonal-cycle">Mean seasonal cycle<a class="anchor" aria-label="anchor" href="#mean-seasonal-cycle"></a>
</h3>
<p><img src="0_p-model_current_run_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="drought-response">Drought response<a class="anchor" aria-label="anchor" href="#drought-response"></a>
</h3>
<p><img src="0_p-model_current_run_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="consistency-with-rpmodel">Consistency with rpmodel<a class="anchor" aria-label="anchor" href="#consistency-with-rpmodel"></a>
</h3>
<p>Since rsofun takes time series forcing, overwrite forcing with
constant values corresponding to the arguments provided to
<code><a href="https://rdrr.io/pkg/rpmodel/man/rpmodel.html" class="external-link">rpmodel::rpmodel()</a></code>.</p>
<div class="section level4">
<h4 id="setup-org">Setup ORG<a class="anchor" aria-label="anchor" href="#setup-org"></a>
</h4>
<pre><code><span><span class="co">## [1] "Are values equivalent for:"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "- ci:ca: Mean relative difference: 19.85932"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "- GPP: Mean relative difference: 1"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "- Vcmax: Mean relative difference: 1"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "- Vcmax25: Mean relative difference: 1"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "- Jmax: Mean relative difference: 215900042"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "- Jmax25: Mean relative difference: 215900412"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="setup-brc">Setup BRC<a class="anchor" aria-label="anchor" href="#setup-brc"></a>
</h4>
<pre><code><span><span class="co">## [1] "Are values equivalent for:"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "- ci:ca: Mean relative difference: 19.85932"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "- GPP: Mean relative difference: 1"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "- Vcmax: Mean relative difference: 1"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "- Vcmax25: Mean relative difference: 1"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "- Jmax: Mean relative difference: 201115440"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "- Jmax25: Mean relative difference: 201115784"</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] RColorBrewer_1.1-3 here_1.0.1         ggthemes_5.1.0     knitr_1.48        </span></span>
<span><span class="co">##  [5] lubridate_1.9.3    ggplot2_3.5.1      readr_2.1.5        tidyr_1.3.1       </span></span>
<span><span class="co">##  [9] dplyr_1.1.4        rsofun_4.4.1       rpmodel_1.2.3     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] remotes_2.5.0        rlang_1.1.4          magrittr_2.0.3      </span></span>
<span><span class="co">##  [4] compiler_4.4.1       mgcv_1.9-1           systemfonts_1.1.0   </span></span>
<span><span class="co">##  [7] callr_3.7.6          vctrs_0.6.5          stringr_1.5.1       </span></span>
<span><span class="co">## [10] profvis_0.3.8        pkgconfig_2.0.3      crayon_1.5.3        </span></span>
<span><span class="co">## [13] fastmap_1.2.0        ellipsis_0.3.2       labeling_0.4.3      </span></span>
<span><span class="co">## [16] utf8_1.2.4           promises_1.3.0       rmarkdown_2.27      </span></span>
<span><span class="co">## [19] sessioninfo_1.2.2    tzdb_0.4.0           ps_1.7.7            </span></span>
<span><span class="co">## [22] nloptr_2.1.1         ragg_1.3.2           purrr_1.0.2         </span></span>
<span><span class="co">## [25] bit_4.0.5            xfun_0.46            cachem_1.1.0        </span></span>
<span><span class="co">## [28] jsonlite_1.8.8       highr_0.11           later_1.3.2         </span></span>
<span><span class="co">## [31] parallel_4.4.1       R6_2.5.1             bslib_0.8.0         </span></span>
<span><span class="co">## [34] stringi_1.8.4        boot_1.3-30          pkgload_1.4.0       </span></span>
<span><span class="co">## [37] jquerylib_0.1.4      Rcpp_1.0.13          usethis_3.0.0       </span></span>
<span><span class="co">## [40] DHARMa_0.4.6         httpuv_1.6.15        Matrix_1.7-0        </span></span>
<span><span class="co">## [43] splines_4.4.1        timechange_0.3.0     tidyselect_1.2.1    </span></span>
<span><span class="co">## [46] yaml_2.3.10          miniUI_0.1.1.1       curl_5.2.1          </span></span>
<span><span class="co">## [49] processx_3.8.4       pkgbuild_1.4.4       plyr_1.8.9          </span></span>
<span><span class="co">## [52] lattice_0.22-6       tibble_3.2.1         shiny_1.9.1         </span></span>
<span><span class="co">## [55] withr_3.0.1          bridgesampling_1.1-2 coda_0.19-4.1       </span></span>
<span><span class="co">## [58] evaluate_0.24.0      desc_1.4.3           urlchecker_1.0.1    </span></span>
<span><span class="co">## [61] pillar_1.9.0         generics_0.1.3       vroom_1.6.5         </span></span>
<span><span class="co">## [64] rprojroot_2.0.4      hms_1.1.3            BayesianTools_0.1.8 </span></span>
<span><span class="co">## [67] munsell_0.5.1        scales_1.3.0         minqa_1.2.7         </span></span>
<span><span class="co">## [70] xtable_1.8-4         glue_1.7.0           GenSA_1.1.14        </span></span>
<span><span class="co">## [73] tools_4.4.1          lme4_1.1-35.5        fs_1.6.4            </span></span>
<span><span class="co">## [76] mvtnorm_1.2-5        grid_4.4.1           yardstick_1.3.1     </span></span>
<span><span class="co">## [79] devtools_2.4.5       colorspace_2.1-1     nlme_3.1-164        </span></span>
<span><span class="co">## [82] cli_3.6.3            textshaping_0.4.0    fansi_1.0.6         </span></span>
<span><span class="co">## [85] Brobdingnag_1.2-9    gtable_0.3.5         sass_0.4.9          </span></span>
<span><span class="co">## [88] digest_0.6.36        htmlwidgets_1.6.4    farver_2.1.2        </span></span>
<span><span class="co">## [91] memoise_2.0.1        htmltools_0.5.8.1    pkgdown_2.1.0       </span></span>
<span><span class="co">## [94] lifecycle_1.0.4      mime_0.12            bit64_4.0.5         </span></span>
<span><span class="co">## [97] MASS_7.3-60.2</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Koen Hufkens.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
